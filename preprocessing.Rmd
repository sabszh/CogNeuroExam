---
title: "Preprocessing"
output: html_document
date: "2023-04-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
pacman::p_load(
  tidyverse,
  ggpubr,
  brms,
  cmdstanr,
  tidybayes,
  ggdist
)

library(ggdist)

theme_set(theme_bw())

options(mc.cores = parallel::detectCores(), 
        brms.backend = "cmdstanr", 
        control = list(adapt_delta = 0.9,
                       max_treedepth = 20)
        )

df <- read_csv('df.csv')
```

```{r}
df <- read_csv('df.csv') %>% 
  filter(!is.na(response_time) & response_time > 0) %>% 
  mutate(correct_resp = ifelse(sub == 101, 1-correct_resp,correct_resp)) %>% 
  group_by(sub,run) %>% 
  arrange(onset,.by_group=T) %>% 
  mutate(image = lead(trial_type),
         acc = mean(correct_resp)) %>% 
  filter(!str_detect(trial_type,'word'))

# Create an empty accuracy column
df$accuracy <- NA

# Use ifelse statements to assign values based on conditions
df$accuracy <- ifelse(df$trial_type == "image_neg" & df$response == "b", 0,
                      ifelse(df$trial_type == "image_neg" & df$response == "y", 1,
                             ifelse(df$trial_type == "image_pos" & df$response == "b", 1,
                                    ifelse(df$trial_type == "image_pos" & df$response == "y", 0, NA))))
```

```{r}
df <- df %>% mutate(valence = !trial_type == 'word_neu')

form <- bf(valence ~ 1+response_time,
           family = bernoulli)

priors = get_prior(form,df)


mod3 <- brm(
  form,
  data = df,
  prior = priors
)


pp_check(mod3,ndraws=100)

summary(mod3)

df
```

```{r}
get_prior(form,df)
```


```{r}
df %>% filter(run == 1) %>% ggplot()+aes(x=response_time,y=trial_type,fill=correct_resp,color=image)+stat_halfeye(alpha=0.5)+xlim(0.3,1)
```

```{r}
df %>% filter(sub == 98)
```


```{r}
df %>% ggplot()+aes(x=acc,y=gender,color=run %>% as.factor())+geom_point()
```

